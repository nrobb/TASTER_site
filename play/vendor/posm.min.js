var POSM=POSM||{};POSM.SettingGroup=function(a,c){this.settings=[];this.indices=c;this.belief=0;this.setSettings(a);this.setBelief()};POSM.SettingGroup.prototype.setSettings=function(a){for(var c=0;c<this.indices.length;c++)this.settings.push(a[this.indices[c]])};POSM.SettingGroup.prototype.setBelief=function(){for(var a=0;a<this.settings.length;a++)this.belief+=this.settings[a].belief};POSM.SettingGroup.prototype.updateBelief=function(a){for(var c=0;c<this.settings.length;c++)this.settings[c].updateBelief(a)};
POSM=POSM||{};POSM.Setting=function(a){this.dimensions={};this.belief=a||1};POSM.Setting.prototype.addDimension=function(a,c,b){this.dimensions[a]={value:c,rank:b}};POSM.Setting.prototype.updateBelief=function(a){this.belief*=a};POSM=POSM||{};POSM.Setup=POSM.Setup||{};POSM.Setup.getSettings=function(a){for(var c=[],b=[],d=0;d<a.length;d++)c.push(0);do b.push(POSM.Setup.getNewSetting(c,a));while(POSM.Setup.increment(c,a));return b};
POSM.Setup.getNewSetting=function(a,c){for(var b=new POSM.Setting,d=0;d<a.length;d++)b.addDimension(c[d].name,c[d].values[a[d]],a[d]);return b};POSM.Setup.increment=function(a,c){for(var b=a.length-1;b>=0;b--)if(a[b]<c[b].values.length-1){a[b]++;return true}else a[b]=0;return false};POSM=POSM||{};POSM.Compare=POSM.Compare||{};POSM.Compare.objectsByValue=function(a,c,b){return a[b]>c[b]?POSM.MORE_THAN:a[b]<c[b]?POSM.LESS_THAN:POSM.EQUAL};
POSM.Compare.settings=function(a,c){var b=[],d;for(d in a.dimensions){comparison=POSM.Compare.objectsByValue(a.dimensions[d],c.dimensions[d],"rank");b.indexOf(comparison)===-1&&b.push(comparison)}switch(b.length){case 1:return b[0];case 2:d=b.indexOf(POSM.EQUAL);return d===-1?false:b[(d+1)%2];case 3:return false}};POSM=POSM||{};POSM.Get=POSM.Get||{};POSM.Get.indicesWhere=function(a,c,b){for(var d=[],e=0;e<b.length;e++)POSM.Compare.settings(a,b[e])===c&&d.push(e);return d};
POSM.Get.settingGroups=function(a,c){for(var b=[],d=0;d<a.length;d++){var e=[],f=a[d];e=e.concat(POSM.Get.indicesWhere(f,c,a));e=e.concat(POSM.Get.indicesWhere(f,POSM.EQUAL,a));b.push(new POSM.SettingGroup(a,e))}return b};POSM.Get.worstCase=function(a,c){for(var b=[],d=0;d<a.length;d++)switch(POSM.Compare.objectsByValue(a[d],c[d],"belief")){case POSM.LESS_THAN:b.push(a[d]);break;case POSM.MORE_THAN:b.push(c[d]);break;default:b.push(POSM.Get.randomFromArray([a,c])[d])}return b};
POSM.Get.bestCase=function(a,c){var b=[a[0]],d=[];d.push(0);for(var e=1;e<a.length;e++)switch(POSM.Compare.objectsByValue(b[0],a[e],"belief")){case POSM.EQUAL:b.push(a[e]);d.push(e);break;case POSM.LESS_THAN:b=[a[e]];d=[e]}if(c)return d;return b};POSM.Get.randomFromArray=function(a){return a[Math.floor(Math.random()*a.length)]};POSM=POSM||{};POSM.DEFAULT_LEARNING_RATE=0.25;POSM.MORE_THAN=1;POSM.LESS_THAN=-1;POSM.EQUAL=0;POSM.TOO_EASY=1;POSM.TOO_HARD=-1;POSM.CORRECT=0;
POSM.Posm=function(a,c){this.settings=[];this.moreDifficult=[];this.lessDifficult=[];if(1<=a||a<=0)throw Error("illegal learning rate");else this.learningRate=a||POSM.DEFAULT_LEARNING_RATE;c&&this.setSettings(c);this.predict()};
POSM.Posm.prototype.predict=function(){this.moreDifficult=POSM.Get.settingGroups(this.settings,POSM.MORE_THAN);this.lessDifficult=POSM.Get.settingGroups(this.settings,POSM.LESS_THAN);var a=POSM.Get.worstCase(this.moreDifficult,this.lessDifficult);this.prediction=POSM.Get.randomFromArray(POSM.Get.bestCase(a,true))};POSM.Posm.prototype.update=function(a){switch(a){case POSM.TOO_HARD:this.moreDifficult[this.prediction].updateBelief(this.learningRate);break;case POSM.TOO_EASY:this.lessDifficult[this.prediction].updateBelief(this.learningRate)}};
POSM.Posm.prototype.setSettings=function(a){if(a)this.settings=POSM.Setup.getSettings(a)};POSM.Posm.prototype.getSetting=function(){return this.settings[this.prediction]};
