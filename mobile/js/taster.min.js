/* taster v0.2.3 - tasterproject.com - (c) 2015-2016 Nigel Robb */

var TASTER=TASTER||{};TASTER.Namespace=function(e){e=e.split(".");var t=TASTER;"TASTER"===e[0]&&(e=e.slice(1));for(var a=0;a<e.length;a++)"undefined"==typeof t[e[a]]&&(t[e[a]]={}),t=t[e[a]];return t},TASTER.Config={WORLD_MARGIN:50,PLAYER_VELOCITY:300,CREATURE_MIN_VELOCITY:15,CREATURE_MAX_VELOCITY:70,CREATURE_VELOCITY_RANGE:20,CREATURE_INITIAL_VELOCITY:40,PLAYER_HIT_STATE_DURATION:1e3,PLAYER_SPRITE_FLASH_DELTA:150,DISPLAY_TARGET_DURATION:1e3,DISPLAY_TARGET_POSITION_1_X:20,DISPLAY_TARGET_POSITION_1_Y:-50,DISPLAY_TARGET_POSITION_2_Y:20,DISPLAY_TARGET_POSITION_2_X:20,DISPLAY_TARGET_DURATION_OUT:500,DISPLAY_TARGET_DURATION_IN:1e3,CREATURE_KEYS:["red-cube","blue-cube","red-pyramid","blue-pyramid"],PLAYER_SPRITE_KEY:"collector",EVENT_NAME_TASK_SWITCH:"task switch",EVENT_NAME_ADD_SPRITE:"add sprite"},TASTER.Namespace("TASTER.Component"),TASTER.Component.Decorator=function(e){var t=TASTER.Component.Init(this,"decorator");t.onTargetSet.add(function(){t.decoration=t.target.addChild(new Phaser.Sprite(t.target.game,0,0,e)).kill(),t.decoration.anchor.setTo(.5)}),t.update=function(){},t.decorate=function(e){t.decoration.reset(),e&&(t.decoration.lifespan=e)},t.removeDecoration=function(){t.decoration.kill()}},TASTER.Namespace("TASTER.Component"),TASTER.Component.Emitter=function(e){var t=TASTER.Component.Init(this,"emitter");t.emitter=e,t.update=function(){},t.explode=function(e,a){t.emitter.x=t.target.x,t.emitter.y=t.target.y,t.emitter.explode(e,a)}},TASTER.Namespace("TASTER.Component"),TASTER.Component.Collectable=function(){var e=TASTER.Component.Init(this,"collectable");e.onCollect=new Phaser.Signal,e.update=function(){},e.collect=function(t){t||console.warn("no argument for collect()"),e.disabled||e.onCollect.dispatch(e.target,t)}},TASTER.Namespace("TASTER.Component"),TASTER.Component.ChaseBehavior=function(e){var t=TASTER.Component.Init(this,"chaseBehavior");t.disabled=e,t.goal=void 0,t.onGoalReached=new Phaser.Signal,t.update=function(){if(!t.disabled){var e=t.target.getComponent("goalBehavior"),a=t.goal;a&&e&&(e.setGoal(a.x,a.y),t.target.game.physics.arcade.intersects(t.target,a)&&(t.removeGoal(),t.onGoalReached.dispatch()))}},t.setGoal=function(e){t.goal=e},t.removeGoal=function(){t.goal=void 0;var e=t.target.getComponent("goalBehavior");e&&e.removeGoal()}},TASTER.Namespace("TASTER.Component"),TASTER.Component.FastBehavior=function(e){var t=TASTER.Component.Init(this,"fastBehavior");t.factor=e,t.update=function(){},t.fast=function(e){if(!t.disabled){var a=t.target.getComponent("velocity").value;t.target.getComponent("velocity").set(a*t.factor),e&&t.target.game.time.events.add(e,function(){t.target.getComponent("velocity").set(a)})}}},TASTER.Namespace("TASTER.Directional8"),TASTER.Component.Directional8=function(){var e=TASTER.Component.Init(this,"directional8");e.update=function(){e.disabled||(e.target.body.velocity.isZero()?e.target.animations.stop():e.target.animations.play(TASTER.Util.getDirection(e.target,e.target.animations.currentFrame.name),5,!0))}},TASTER.Namespace("TASTER.Component"),TASTER.Component.FlashBehavior=function(e,t){var a=TASTER.Component.Init(this,"flashBehavior");a.disabled=t,a.rate=e,a.previous=0,a.update=function(){if(a.disabled)a.target.alpha=1;else{var e=a.target.game.time.now;e-a.previous>a.rate&&(a.flash(),a.previous=e)}},a.flash=function(){a.target.alpha=1===a.target.alpha?.1:1}},TASTER.Namespace("TASTER.Component"),TASTER.Component.GoalBehavior=function(){var e=TASTER.Component.Init(this,"goalBehavior");e.goal=void 0,e.update=function(){if(!e.disabled){var t=e.target.getComponent("velocity").value,a=e.goal;a&&t&&(e.target.game.physics.arcade.moveToObject(e.target,a,t),e.target.game.physics.arcade.distanceBetween(e.target,a)<t/15&&e.removeGoal())}},e.setGoal=function(t,a){e.goal={},e.goal.x=t,e.goal.y=a,e.goal.active=!0},e.removeGoal=function(){e.goal=void 0,e.target.body.velocity.setTo(0)}},TASTER.Namespace("TASTER.Component"),TASTER.Component.GodBehavior=function(){var e=TASTER.Component.Init(this,"godBehavior");e.update=function(){},e.god=function(t){e.target.disableComponent("hittable"),t&&e.target.game.time.events.add(t,function(){e.target.enableComponent("hittable")})}},TASTER.Namespace("TASTER.Component"),TASTER.Component.Hittable=function(){var e=TASTER.Component.Init(this,"hittable");e.onHit=new Phaser.Signal,e.update=function(){},e.hit=function(t){t||console.warn("no argument for hit()"),e.disabled||e.onHit.dispatch(e.target,t)}},TASTER.Namespace("TASTER.Component"),TASTER.Component.GhostBehavior=function(){var e=TASTER.Component.Init(this,"ghostBehavior");e.update=function(){},e.ghost=function(t){e.disabled||(e.target.disableComponent("hittable"),e.target.enableComponent("flashBehavior"),t&&e.target.game.time.events.add(t,function(){e.target.enableComponent("hittable"),e.target.disableComponent("flashBehavior")}))}},TASTER.Namespace("TASTER.Component"),TASTER.Component.IComponent=function(){TASTER.Component.Init(this,"iComponent").update=function(){}},TASTER.Namespace("TASTER.Component"),TASTER.Component.Init=function(e,t){return e.name=t,e.target=null,e.disabled=!1,e.setTarget=function(t){e.target=t},e.onTargetSet=new Phaser.Signal,e},TASTER.Namespace("TASTER.Component"),TASTER.Component.RecoilBehavior=function(e){var t=TASTER.Component.Init(this,"recoilBehavior");t.velocity=e,t.onRecoiled=new Phaser.Signal,t.update=function(){},t.recoil=function(e,a){a=a||100;var n=t.target.game.physics.arcade.angleBetween(t.target,e),i=t.target.x,s=t.target.y;.25*Math.PI<n&&n<.75*Math.PI?s-=a:Math.PI*-.25<n&&n<.25*Math.PI?i-=a:Math.PI*-.75<n&&n<Math.PI*-.25?s+=a:i+=a,t.target.game.add.tween(t.target).to({x:i,y:s},75,Phaser.Easing.Default,!0).onComplete.add(function(){t.onRecoiled.dispatch()})}},TASTER.Namespace("TASTER.Component"),TASTER.Component.SlowBehavior=function(e){var t=TASTER.Component.Init(this,"slowBehavior");t.factor=e,t.update=function(){},t.slow=function(e){if(!t.disabled){var a=t.target.getComponent("velocity").value;t.target.getComponent("velocity").set(a/t.factor),e&&t.target.game.time.events.add(e,function(){t.target.getComponent("velocity").set(a)})}}},TASTER.Namespace("TASTER.Component"),TASTER.Component.Velocity=function(e){var t=TASTER.Component.Init(this,"velocity");t.value=e,t.update=function(){},t.set=function(e){t.value=e},t.get=function(){return t.value}},TASTER.Namespace("TASTER.Component"),TASTER.Component.WanderBehavior=function(e){var t=TASTER.Component.Init(this,"wanderBehavior");t.rate=e,t.previous=-t.rate,t.update=function(){if(!t.disabled){var e=t.target.game.time.now;e-t.previous>t.rate&&(t.wander(),t.previous=e)}},t.wander=function(){var e=t.target.getComponent("goalBehavior");e&&e.setGoal(t.target.game.world.randomX,t.target.game.world.randomY)}},TASTER.Namespace("TASTER.Data"),TASTER.Data.Event=function(e,t){if(this.time=(new Date).getTime(),this.name=e,this.data="",t)for(var a=0;a<t.length;a++)this.data+=t[a]+","},TASTER.Namespace("TASTER.Data"),TASTER.Data.Wave=function(e){this.id=e,this.events=[],this.successRate=0,this.start=(new Date).getTime(),this.nTotalHit=this.nDistractorsHit=this.nTargetsHit=this.timePerTarget=this.duration=this.end=0,this.difficultySetting="xx:xx:xx"},TASTER.Namespace("TASTER.Data"),TASTER.Data.Game=function(e,t,a){this.playerId=e,this.blockLength=this.score=0,this.created=(new Date).toString(),this.waves=[],this.updater=t,this.onNewWave=a},TASTER.Data.Game.prototype.update=function(e){return this.score=Math.max(this.score+e,0),this.updater.update(this.wave,e),this.score},TASTER.Data.Game.prototype.endWave=function(){this.wave&&(this.wave.end=(new Date).getTime())},TASTER.Data.Game.prototype.startWave=function(){this.wave=new TASTER.Data.Wave(this.waves.length),this.waves.push(this.wave),this.onNewWave.dispatch()},TASTER.Namespace("TASTER.Data"),TASTER.Data.Updater=function(e,t){this.maxStreak=e,this.maxFailStreak=t,this.failStreak=this.streak=0,this.onStreak=new Phaser.Signal,this.onFailStreak=new Phaser.Signal},TASTER.Data.Updater.prototype.update=function(e,t){this.updateDuration(e,t),this.updateHits(e,t),this.updateStreaks(e,t),this.updateSuccessRate(e,t),this.updateTimePerTarget(e,t)},TASTER.Data.Updater.prototype.updateDuration=function(e){var t=(new Date).getTime();e.duration=t-e.start},TASTER.Data.Updater.prototype.updateHits=function(e,t){switch(e.nTotalHit++,t>0){case!0:e.nTargetsHit++;break;case!1:e.nDistractorsHit++}},TASTER.Data.Updater.prototype.updateStreaks=function(e,t){switch(t>0){case!0:this.streak++,this.failStreak=0,this.streak>=this.maxStreak&&(this.streak=0,this.onStreak.dispatch());break;case!1:this.failStreak++,this.streak=0,this.failStreak>=this.maxFailStreak&&(this.failStreak=0,this.onFailStreak.dispatch())}},TASTER.Data.Updater.prototype.updateSuccessRate=function(e){e.successRate=e.nTargetsHit/e.nTotalHit},TASTER.Data.Updater.prototype.updateTimePerTarget=function(e){e.timePerTarget=e.duration/e.nTargetsHit},TASTER.Namespace("TASTER.Data");try{TASTER.Data.ParseObject=TASTER.Data.ParseObject||Parse.Object.extend("gameData")}catch(error){console.warn(error)}TASTER.Data.Save=function(e){this.dataManager=e},TASTER.Data.Save.prototype.event=function(e,t){var a=new TASTER.Data.Event(e,t);return this.dataManager.game.wave.events.push(a),a},TASTER.Data.Save.prototype.game=function(e){var t=new TASTER.Data.ParseObject;t.setACL(new Parse.ACL(Parse.User.current())),t.set("playerId",e.playerId),t.set("score",e.score),t.set("blockLength",e.blockLength),t.set("created",e.created),"string"==typeof e.waves?t.set("waves",e.waves):t.set("waves",JSON.stringify(e.waves)),t.save(null,{success:function(){},error:function(e){var t=JSON.parse(localStorage.getItem("unsavedGames"));if(t){for(var a=!1,n=0;n<t.length;n++)t[n].created===e.created&&(a=!0);a||t.push(e)}else t=[e];localStorage.setItem("unsavedGames",JSON.stringify(t))}})},TASTER.Data.Save.prototype.all=function(){var e=JSON.parse(localStorage.getItem("unsavedGames"));if(localStorage.removeItem("unsavedGames"),e)for(var t=0;t<e.length;t++)this.game(e[t]);this.game(this.dataManager.game),this.dataManager.reset()},TASTER.Data.Save.prototype.playerSettings=function(e,t,a,n){var i=new(Parse.Object.extend("playerSettings"));i.set("playerId",e),i.set("score",t),i.set("difficultySettingIndices",a),i.set("switchingSettingIndices",n),i.save()},TASTER.Namespace("TASTER.Data"),TASTER.Data.Manager=function(){this.save=new TASTER.Data.Save(this),this.onUpdate=new Phaser.Signal,this.updater=new TASTER.Data.Updater(2,2),this.onNewWave=new Phaser.Signal,this.reset()},TASTER.Data.Manager.prototype.update=function(e){this.game.update(e),this.onUpdate.dispatch()},TASTER.Data.Manager.prototype.reset=function(){this.game=new TASTER.Data.Game(this.getId(),this.updater,this.onNewWave)},TASTER.Data.Manager.prototype.getId=function(){var e=localStorage.getItem("activeProfile");return"guest"===e?e:TASTER.Util.getProfile(e).id},TASTER.Namespace("TASTER.DDA"),TASTER.DDA.SimpleDDA=function(e,t){this.dimensions={},this.dimensionNames=[];for(var a in e)this.dimensions[e[a].name]={},this.dimensions[e[a].name].values=e[a].values,this.dimensions[e[a].name].index=t[a]||0,this.dimensionNames.push(e[a].name)},TASTER.DDA.SimpleDDA.prototype.easier=function(e){e=e||Phaser.ArrayUtils.getRandomItem(this.dimensionNames),e=this.dimensions[e],e.index=Math.max(e.index-1,0)},TASTER.DDA.SimpleDDA.prototype.harder=function(e){e=e||Phaser.ArrayUtils.getRandomItem(this.dimensionNames),e=this.dimensions[e],e.index=Math.min(e.index+1,e.values.length-1)},TASTER.DDA.SimpleDDA.prototype.getSetting=function(){var e,t={dimensions:{}};for(e in this.dimensions)t.dimensions[e]={},t.dimensions[e].value=this.dimensions[e].values[this.dimensions[e].index],t.dimensions[e].index=this.dimensions[e].index;return t},TASTER.DDA.SimpleDDA.prototype.getSettingIndices=function(){var e,t=[],a=this.getSetting();for(e in a.dimensions)t.push(a.dimensions[e].index);return t},TASTER.Namespace("TASTER.Entity"),TASTER.Entity.Sprite=function(e,t,a,n){Phaser.Sprite.call(this,e,t,a,n),this.name=n,this.customComponents={}},TASTER.Entity.Sprite.prototype=Object.create(Phaser.Sprite.prototype),TASTER.Entity.Sprite.prototype.constructor=TASTER.Entity.Sprite,TASTER.Entity.Sprite.prototype.addComponent=function(e){return this.customComponents[e.name]=e,this.customComponents[e.name].setTarget(this),e.onTargetSet.dispatch(),e},TASTER.Entity.Sprite.prototype.disableComponent=function(e){(e=this.customComponents[e])&&(e.disabled=!0)},TASTER.Entity.Sprite.prototype.enableComponent=function(e){(e=this.customComponents[e])&&(e.disabled=!1)},TASTER.Entity.Sprite.prototype.getComponent=function(e){return this.customComponents[e]?this.customComponents[e]:void 0},TASTER.Entity.Sprite.prototype.removeComponent=function(e){var t=this.customComponents[e];return t?(delete this.customComponents[e],t):void 0},TASTER.Entity.Sprite.prototype.update=function(){Object.keys(this.customComponents).forEach(function(e){this.customComponents[e].update()},this)},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.Game=function(e){},TASTER.GameState.Game.prototype.create=function(){},TASTER.GameState.Game.prototype.update=function(){this.handleInput(),this.physics.arcade.collide(this.creatures),this.physics.arcade.collide(this.creatures,[this.fastPowerUp,this.slowPowerUp,this.scorePanel,this.targetPanel]),this.physics.arcade.collide(this.player,[this.scorePanel,this.targetPanel]),this.physics.arcade.collide(this.player,[this.fastPowerUp,this.slowPowerUp],this.collectPowerUp,null,this),this.physics.arcade.collide(this.player,this.obstacle,null,this.collidePlayerWithObstacle,this),this.physics.arcade.collide(this.player,this.creatures,null,this.collidePlayerWithCreature,this)},TASTER.GameState.Game.prototype.pauseGame=function(){this.cuePanel.hide(),this.quitButton.reset(this.world.centerX,200),this.game.paused=!0,this.input.onUp.addOnce(this.unpauseClick,this)},TASTER.GameState.Game.prototype.unpauseClick=function(e){this.game.paused=!1,this.quitButton.kill(),this.pausedText.kill();var t=new Phaser.Rectangle(this.quitButton.left,this.quitButton.top,this.quitButton.width,this.quitButton.height);t.contains(e.x,e.y)&&this.quitGame("Title")},TASTER.GameState.Game.prototype.playerCollectCreature=function(e,t){this.data.update(1)},TASTER.GameState.Game.prototype.playerHitByCreature=function(e,t){this.data.update(-1),this.showTargetCues()},TASTER.GameState.Game.prototype.collidePlayerWithCreature=function(e,t){var a=t.getComponent("hittable"),n=t.getComponent("collectable");if(n&&a){switch(n.disabled){case!0:var i=e.getComponent("hittable");if(!i)return;i.onHit.addOnce(this.playerHitByCreature,this),i.hit(t);break;case!1:this.playerCollectCreature(e,t),a.hit(e)}return!1}},TASTER.GameState.Game.prototype.collidePlayerWithObstacle=function(e,t){this.data.game.streak=0;var a=t.getComponent("hittable"),n=e.getComponent("hittable");return a&&n&&(a.hit(e),n.hit(t)),!1},TASTER.GameState.Game.prototype.addObstacle=function(e){this.sound.stop("alarm"),e||(e=this.worldManager.getRandomPoint(400)),this.obstacle.lifespan=3e3,this.obstacle.reset(e.x,e.y);var t=this.obstacle.getComponent("chaseBehavior");t&&t.setGoal(this.player)},TASTER.GameState.Game.prototype.addObstacleWarning=function(e){if(!this.obstacle.alive&&!this.warning.alive){var t=this.worldManager.getRandomPoint(400);t&&(this.warning.lifespan=e||2e3,this.warning.events.onKilled.addOnce(this.addObstacle,this,0,t),this.warning.reset(t.x,t.y),this.sound.play("alarm",null,null,.3,!0))}},TASTER.GameState.Game.prototype.addPowerUp=function(){if(!this.fastPowerUp.alive&&!this.slowPowerUp.alive){var e=this.worldManager.getRandomPoint(400);if(e){var t=Phaser.ArrayUtils.getRandomItem([this.fastPowerUp,this.slowPowerUp]);t.lifespan=5e3,t.reset(e.x,e.y),this.sound.play("blip")}}},TASTER.GameState.Game.prototype.collectPowerUp=function(e,t){var a=t.getComponent("hittable");a&&(a.hit(e),this.sound.play("collect-coin"))},TASTER.GameState.Game.prototype.onTaskComplete=function(){this.data.game.endWave();var e=this.player.getComponent("godBehavior");if(e&&e.god(500),12===this.data.game.waves.length)this.levelComplete();else{this.adjustDifficulty();var t=this.ddaTask.getSetting().dimensions["switch"].value;this.data.game.waves.length%t===0&&"true"===localStorage.getItem("switching")?this.task["switch"]():this.task.resetTask(),this.data.game.startWave()}},TASTER.GameState.Game.prototype.levelComplete=function(){this.creatures.callAll("kill"),TASTER.Util.isPerfectGame(this.data.game.waves)?this.perfectPanel.show():this.superPanel.show(),this.adjustSwitchingDifficulty(),this.game.time.events.add(2e3,this.quitGame,this,"LevelComplete")},TASTER.GameState.Game.prototype.quitGame=function(e){this.data.save.event("game over");for(var t in this.sound.sounds)this.sound.stop(t);TASTER.music&&"Title"===e&&TASTER.music.stop();for(var a in this.destroyables)this.destroyables[a].destroy();localStorage.setItem("lastScore",this.data.game.score);var n=localStorage.getItem("activeProfile");this.save(n),this.data.save.all(),this.state.start(e)},TASTER.GameState.Game.prototype.save=function(e){if("guest"!==e){var t=TASTER.Util.getProfile(e);this.data.save.playerSettings(t.id,this.data.game.score,this.dda.getSettingIndices(),this.ddaTask.getSettingIndices())}},TASTER.GameState.Game.prototype.showAllCues=function(){this.showTargetCues(),this.showPanelCues()},TASTER.GameState.Game.prototype.setPanelCues=function(){this.targetPanel.removeChildren(),this.targetPanel.addChild(this.targetPanel.targetSprites[this.task.target]),this.cuePanel.removeChildren(),this.cuePanel.addChild(this.cuePanel.targetSprites[this.task.target])},TASTER.GameState.Game.prototype.showPanelCues=function(){this.setPanelCues(),this.cuePanel.show()},TASTER.GameState.Game.prototype.showTargetCues=function(){for(var e=0;e<this.creatures.children.length;e++){var t=this.creatures.children[e],a=t.getComponent("collectable"),n=t.getComponent("decorator");a&&n&&(n.removeDecoration(),a.disabled||n.decorate(2e3))}},TASTER.GameState.Game.prototype.handleInput=function(){if(this.input.activePointer.isDown){var e=this.player.getComponent("goalBehavior");e.setGoal(this.input.worldX,this.input.worldY)}},TASTER.GameState.Game.prototype.adjustDifficulty=function(){switch(this.data.game.wave.successRate>.75){case!0:this.dda.harder();break;case!1:this.dda.easier()}},TASTER.GameState.Game.prototype.adjustSwitchingDifficulty=function(){var e=TASTER.Util.assessSwitchingSkill(this.data.game.waves,this.ddaTask.getSetting().dimensions["switch"].value);switch(e){case"harder":this.ddaTask.harder();break;default:this.ddaTask.easier()}},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.Earth=function(e){TASTER.GameState.Game.call(this,e)},TASTER.GameState.Earth.prototype=Object.create(TASTER.GameState.Game.prototype),TASTER.GameState.Earth.prototype.constructor=TASTER.GameState.Earth,TASTER.GameState.Earth.prototype.create=function(){TASTER.Get.Game(this,"earth"),this.data.game.startWave(),TASTER.music&&TASTER.music.isPlaying||(TASTER.music=this.game.add.audio("music",1,!0),TASTER.Util.getMusicSetting()&&TASTER.music.play(null,null,.7))},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.GetUserName=function(){},TASTER.GameState.GetUserName.prototype.create=function(){this.add.button(10,10,"back-button",function(){this.state.start("Title")},this,1,1,1,1),this.keyboard=new TASTER.Keyboard.Full(this.game,this.game.width,16),this.promt=this.add.text(this.game.world.centerX,100,"Enter your name:"),this.promt.anchor.setTo(.5,.5),this.id=this.add.text(this.game.world.centerX,175),this.id.anchor.setTo(.5,.5),this.keyboard.onTextUpdate.add(function(){this.id.setText(this.keyboard.text)},this);var e=this;e.onEnter=function(){var t=JSON.parse(localStorage.getItem("tasterProfiles"))||[];t.length<3&&(t.push({id:localStorage.getItem("newUserID"),name:e.keyboard.text,total:0,difficultySettingIndices:[0,0,0],switchingSettingIndices:[0]}),localStorage.setItem("tasterProfiles",JSON.stringify(t)),localStorage.removeItem("newUserID")),e.state.start("Title")},this.keyboard.onEnter.add(e.onEnter),this.enterButton=this.add.button(this.game.world.centerX,250,"enter-button",this.onEnter,this),this.enterButton.anchor.setTo(.5,.5)},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.LevelComplete=function(e){},TASTER.GameState.LevelComplete.prototype.create=function(){this.stage.setBackgroundColor("#ffffff");var e=this.world.centerX-this.game.cache.getImage("title").width/2,t=localStorage.getItem("lastScore");localStorage.removeItem("lastScore"),this.add.existing(TASTER.Get.TextButton(this.game,e,100,"medium-black-rectangle","Score: "+t,null,null,1,1,1,1,14)),this.add.existing(TASTER.Get.TextButton(this.game,e,200,"medium-black-rectangle-blue","play again",function(){this.state.start("Earth")},this,1,1,1,1,14)),this.add.existing(TASTER.Get.TextButton(this.game,e,300,"medium-black-rectangle-blue","quit",function(){this.state.start("Title")},this,1,1,1,1,14));var i=localStorage.getItem("activeProfile"),a=JSON.parse(localStorage.getItem("tasterProfiles"))||[];for(var r in a)a[r].name===i&&(this.profile=a[r]);var l=Parse.Object.extend("playerSettings"),n=new Parse.Query(l);n.equalTo("playerId",this.profile.id),n.descending("createdAt");var o=this;n.find({success:function(e){if(e.length>0){o.profile.total=0;for(var t in e)o.profile.total+=e[t].get("score");o.profile.difficultySettingIndices=e[0].get("difficultySettingIndices"),o.profile.switchingSettingIndices=e[0].get("switchingSettingIndices"),TASTER.Util.saveProfile(o.profile)}},error:function(e){console.warn("error connecting to parse")}})},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.Info=function(){},TASTER.GameState.Info.prototype.create=function(){this.add.button(10,10,"back-button",function(){this.state.start("Title")},this,1,1,1,1),this.add.text(100,100,"Touch the screen to move"),this.add.text(100,200,"Catch the creatures"),this.add.text(100,300,"But be careful!"),this.add.text(100,400,"Some of the creatures"),this.add.text(100,450,"are not safe to touch")},TASTER.GameState.Info.prototype.preload=function(){},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.GetId=function(){},TASTER.GameState.GetId.prototype.create=function(){this.add.button(10,10,"back-button",function(){this.state.start("Title")},this,1,1,1,1),this.keyboard=new TASTER.Keyboard.Numeric(this.game,this.game.width,4),this.prompt=this.add.text(this.game.world.centerX,100,"Enter your id number:"),this.prompt.anchor.setTo(.5,.5),this.id=this.add.text(this.game.world.centerX,175),this.id.anchor.setTo(.5,.5),this.keyboard.onTextUpdate.add(function(){this.id.setText(this.keyboard.text)},this);var e=this;e.onEnter=function(){4===e.keyboard.text.length?(localStorage.setItem("newUserID",e.keyboard.text),e.state.start("GetUserName")):e.prompt.setText("Your id is a 4 digit number")},this.keyboard.onEnter.add(e.onEnter),this.enterButton=this.add.button(this.game.world.centerX,250,"enter-button",this.onEnter,this),this.enterButton.anchor.setTo(.5,.5)},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.ParseConnectError=function(){},TASTER.GameState.ParseConnectError.prototype.create=function(){this.game.scale.stopFullScreen(),TASTER.music&&TASTER.music.stop(),this.stage.setBackgroundColor("#ffffff"),this.noConnection=this.add.text(this.game.world.centerX,100,"No internet connection!"),this.noConnection.anchor.setTo(.5,.5),this.check=this.add.text(this.game.world.centerX,200,"Please check your connection"),this.check.anchor.setTo(.5,.5),this.relaunch=this.add.text(this.game.world.centerX,300,"and relaunch the game"),this.relaunch.anchor.setTo(.5,.5)},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.Settings=function(){},TASTER.GameState.Settings.prototype.create=function(){this.add.button(10,10,"back-button",function(){this.state.start("Title")},this,1,1,1,1);var e=this.world.centerX-this.game.cache.getImage("title").width/2;this.add.existing(TASTER.Get.TextButton(this.game,e,200,"medium-black-rectangle","manage profiles",function(){this.state.start("DeleteProfile")},this,1,1,1,1,14)),this.soundButton=this.add.button(e,300,"music-button",function(){switch(TASTER.Util.getMusicSetting()){case 1:TASTER.Util.setMusicSetting(!1),this.soundButton.frame=TASTER.Util.getMusicSetting();break;case 0:TASTER.Util.setMusicSetting(!0),this.soundButton.frame=TASTER.Util.getMusicSetting()}},this),this.soundButton.frame=TASTER.Util.getMusicSetting()},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.Preloader=function(){},TASTER.GameState.Preloader.prototype.preload=function(){this.add.text(this.world.centerX-this.game.cache.getImage("preloaderBar").width/2,this.world.centerY-100,"LOADING...",{fill:"black"}),this.preloadBar=this.add.sprite(this.world.centerX-this.game.cache.getImage("preloaderBar").width/2,this.world.centerY,"preloaderBar"),this.load.setPreloadSprite(this.preloadBar),this.load.image("earth","assets/tile_sprites/scorched_earth.png"),this.load.image("white-ring","assets/images/white-ring.png"),this.load.image("red-circle","assets/images/red-circle.png"),this.load.image("blue-circle","assets/images/blue-circle.png"),this.load.image("red","assets/images/red.png"),this.load.image("blue","assets/images/blue.png"),this.load.image("wireframe-cube","assets/images/wireframe-cube.png"),this.load.image("wireframe-pyramid","assets/images/wireframe-pyramid.png"),this.load.image("wireframe-cube-large","assets/images/wireframe-cube-large.png"),this.load.image("wireframe-pyramid-large","assets/images/wireframe-pyramid-large.png"),this.load.image("title","assets/images/taster-logo.png"),this.load.image("large-black-square","assets/images/large-black-square.png"),this.load.image("small-black-square","assets/images/small-black-square.png"),this.load.image("small-black-square-no-arrow","assets/images/small-black-square-no-arrow.png"),this.load.image("medium-black-rectangle","assets/images/medium-black-rectangle.png"),this.load.image("medium-black-rectangle-red","assets/images/medium-black-rectangle-red.png"),this.load.image("medium-black-rectangle-blue","assets/images/medium-black-rectangle-blue.png"),this.load.image("score-panel","assets/images/score-panel.png"),this.load.image("lightning-bolt","assets/images/lightning-bolt.png"),this.load.image("warning","assets/images/warning.png"),this.load.image("clock","assets/images/clock.png"),this.load.image("pause-button","assets/buttons/pause-button.png"),this.load.image("paused-text","assets/images/paused-label.png"),this.load.image("pefect-panel","assets/images/perfect-panel.png"),this.load.image("super-panel","assets/images/super-panel.png"),this.load.image("quit-button","assets/buttons/quit-button.png"),this.load.image("back-button","assets/buttons/back-button.png"),this.load.image("enter-button","assets/buttons/enter-button.png"),this.load.image("settings-button","assets/buttons/settings-cog.png"),this.load.image("info-button","assets/buttons/info-button.png"),this.load.bitmapFont("carrier-command","assets/fonts/carrier-command.png","assets/fonts/carrier-command.xml"),this.load.atlasJSONArray(TASTER.Config.CREATURE_KEYS[0],"assets/sprites/red-cube.png","assets/sprites/red-cube.json"),this.load.atlasJSONArray(TASTER.Config.CREATURE_KEYS[1],"assets/sprites/blue-cube.png","assets/sprites/blue-cube.json"),this.load.atlasJSONArray(TASTER.Config.CREATURE_KEYS[2],"assets/sprites/red-pyramid.png","assets/sprites/red-pyramid.json"),this.load.atlasJSONArray(TASTER.Config.CREATURE_KEYS[3],"assets/sprites/blue-pyramid.png","assets/sprites/blue-pyramid.json"),this.load.atlasJSONArray(TASTER.Config.PLAYER_SPRITE_KEY,"assets/sprites/collector.png","assets/sprites/collector.json"),this.load.spritesheet("music-button","assets/buttons/music-button.png",282,76),this.load.spritesheet("rock","assets/sprites/rock.png",64,64),this.load.audio("music",["assets/audio/music.ogg","assets/audio/music.m4a"]),this.load.audio("explosion",["assets/audio/explosion.ogg","assets/audio/explosion.m4a"]),this.load.audio("blip",["assets/audio/blip.ogg","assets/audio/blip.m4a"]),this.load.audio("alarm",["assets/audio/alarm.ogg","assets/audio/alarm.m4a"]),this.load.audio("collect-coin",["assets/audio/collect-coin.ogg","assets/audio/collect-coin.m4a"]),this.load.audio("hurt",["assets/audio/hurt.ogg","assets/audio/hurt.m4a"])},TASTER.GameState.Preloader.prototype.create=function(){this.preloadBar.cropEnabled=!1,this.state.start("Title")},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.Title=function(){},TASTER.GameState.Title.prototype.create=function(){this.game.scale.stopFullScreen(),TASTER.music&&TASTER.music.stop(),this.stage.setBackgroundColor("#ffffff"),this.add.image(this.world.centerX-this.game.cache.getImage("title").width/2,100,"title"),this.add.button(10,10,"info-button",function(){this.state.start("Info")},this),this.add.button(this.game.width-10,10,"settings-button",function(){this.state.start("Settings")},this).anchor.setTo(1,0),this.addProfileButtons()},TASTER.GameState.Title.prototype.addProfileButtons=function(){this.profiles=JSON.parse(localStorage.getItem("tasterProfiles"))||[];for(var e=this.world.centerX-this.game.cache.getImage("title").width/2,t=200,a=0;2>a;a++,t+=100)this.profiles[a]?this.addButton(this.profiles[a].name,e,t):this.addButton("add new player",e,t);this.addButton("guest",e,t)},TASTER.GameState.Title.prototype.addButton=function(e,t,a){this.add.existing(TASTER.Get.TextButton(this.game,t,a,"medium-black-rectangle",e,function(){switch(e){case"add new player":this.state.start("GetId");break;case"guest":localStorage.setItem("activeProfile","guest"),localStorage.setItem("switching","true"),this.game.scale.startFullScreen(!1),this.state.start("Earth");break;default:localStorage.setItem("activeProfile",e),this.state.start("Profile")}},this,1,1,1,1,14))},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.Profile=function(){},TASTER.GameState.Profile.prototype.create=function(){this.game.scale.stopFullScreen(),this.stage.setBackgroundColor("#ffffff"),this.add.button(10,10,"back-button",function(){this.state.start("Title")},this,1,1,1,1);var e,t=localStorage.getItem("activeProfile"),a=JSON.parse(localStorage.getItem("tasterProfiles"))||[];for(e in a)a[e].name===t&&(this.profile=a[e]);t=Parse.Object.extend("playerSettings"),t=new Parse.Query(t),t.equalTo("playerId",this.profile.id),t.descending("createdAt");var n=this;t.find({success:function(e){if(e.length>0){n.profile.total=0;for(var t in e)n.profile.total+=e[t].get("score");n.profile.difficultySettingIndices=e[0].get("difficultySettingIndices"),n.profile.switchingSettingIndices=e[0].get("switchingSettingIndices"),TASTER.Util.saveProfile(n.profile)}e=n.world.centerX-n.game.cache.getImage("title").width/2,n.add.existing(TASTER.Get.TextButton(n.game,e,100,"medium-black-rectangle",n.profile.name,null,null,1,1,1,1,14)),n.add.existing(TASTER.Get.TextButton(n.game,e,200,"medium-black-rectangle","Score: "+n.profile.total,null,null,1,1,1,1,14)),n.add.existing(TASTER.Get.TextButton(n.game,e,300,"medium-black-rectangle-blue","play",n.playButtonClicked,n,1,1,1,1,14))}})},TASTER.GameState.Profile.prototype.playButtonClicked=function(){this.game.scale.startFullScreen(!1);var e=Parse.Object.extend("controlGroup");e=new Parse.Query(e),e.exists("ids");var t=parseInt(this.profile.id),a=this;e.first({success:function(e){controlIds=JSON.parse(e.get("ids")),-1===controlIds.indexOf(t)?localStorage.setItem("switching","true"):localStorage.setItem("switching","false"),a.state.start("Earth")},error:function(){localStorage.setItem("switching","true"),a.state.start("Earth")}})},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.Boot=function(){},TASTER.GameState.Boot.prototype.init=function(){this.input.maxPointers=1,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0},TASTER.GameState.Boot.prototype.create=function(){this.stage.setBackgroundColor("#ffffff"),this.state.start("Preloader")},TASTER.GameState.Boot.prototype.preload=function(){this.load.image("preloaderBar","assets/images/preloadr-bar.png")},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.Confirm=function(){},TASTER.GameState.Confirm.prototype.create=function(){var e,t,a=localStorage.getItem("activeProfile"),n=JSON.parse(localStorage.getItem("tasterProfiles"))||[];for(t in n)n[t].name===a&&(this.profile=n[t],e=t);this.stage.setBackgroundColor("#ffffff"),this.add.button(10,10,"back-button",function(){this.state.start("Settings")},this,1,1,1,1),a=this.world.centerX-this.game.cache.getImage("title").width/2,this.add.existing(TASTER.Get.TextButton(this.game,a,100,"medium-black-rectangle",this.profile.name,null,null,1,1,1,1,14)),this.add.existing(TASTER.Get.TextButton(this.game,a,300,"medium-black-rectangle-red","delete",function(){
n.splice(e,1),localStorage.setItem("tasterProfiles",JSON.stringify(n)),this.state.start("Title")},this,1,1,1,1,14))},TASTER.Namespace("TASTER.GameState"),TASTER.GameState.DeleteProfile=function(){},TASTER.GameState.DeleteProfile.prototype.create=function(){this.stage.setBackgroundColor("#ffffff"),this.add.button(10,10,"back-button",function(){this.state.start("Settings")},this,1,1,1,1),this.addProfileButtons()},TASTER.GameState.DeleteProfile.prototype.addProfileButtons=function(){this.profiles=JSON.parse(localStorage.getItem("tasterProfiles"))||[];var e=this.world.centerX-this.game.cache.getImage("title").width/2,t=200;0===this.profiles.length&&this.add.existing(TASTER.Get.TextButton(this.game,e,t,"medium-black-rectangle","no profiles",null,null,1,1,1,1,14));for(var a in this.profiles)this.addButton(this.profiles[a].name,e,t),t+=100},TASTER.GameState.DeleteProfile.prototype.addButton=function(e,t,a){this.add.existing(TASTER.Get.TextButton(this.game,t,a,"medium-black-rectangle",e,function(){localStorage.setItem("activeProfile",e),this.state.start("Confirm")},this,1,1,1,1,14))},TASTER.Namespace("TASTER.Task"),TASTER.Task.Manager=function(e,t,a){this.target,this.task,this.onTaskSet=new Phaser.Signal,this.tasks={},this.taskSettable=t,this.dda=a,this.init(e)},TASTER.Task.Manager.prototype.resetTask=function(){var e=this.dda.getSetting(),t=e.dimensions.total.value,a=Math.max(1,Math.floor(t*e.dimensions.targets.value)),n=t-a,i=e.dimensions.uniformity.value;this.taskSettable.setTask(a,n,this.target,i),this.onTaskSet.dispatch()},TASTER.Task.Manager.prototype.setTask=function(e){this.task=e,this.target=Phaser.ArrayUtils.getRandomItem(this.tasks[this.task]),this.resetTask()},TASTER.Task.Manager.prototype.setTarget=function(e){for(var t in this.tasks)this.tasks[t].indexOf(e)>-1&&(this.task=t);this.target=e,this.resetTask()},TASTER.Task.Manager.prototype.init=function(e){for(var t in e)this.tasks[t]=e[t];this["switch"]()},TASTER.Task.Manager.prototype["switch"]=function(){var e=[];for(var t in this.tasks)t!==this.task&&e.push(t);var t=Phaser.ArrayUtils.getRandomItem(e);this.setTask(t)},TASTER.Namespace("TASTER.Task.Set"),TASTER.Task.Set.ensure=function(e,t,a,n,i,s){a=TASTER.Task.Set.getAvailableKeys(e.keys,e[t],a,s),n=[n,i],i=0;for(var o in e[t]){for(s=0;s<n[i];s++){var r=e.worldManager.getRandomPoint(200),l=e[t][o][s];if(l)l.reset(r.x,r.y);else{l="";for(var c in a)a[c].indexOf(o)>-1&&(l=a[c]);e[t][o].push(e.create(r.x,r.y,l))}}i++}},TASTER.Task.Set.getAvailableKeys=function(e,t,a,n){for(var i in t){var s,o=[];for(s in e)switch(n){case!0:e[s].indexOf(a)>-1&&o.push(e[s]);break;case!1:-1===e[s].indexOf(a)&&o.push(e[s])}}return o},TASTER.Task.Set.sort=function(e,t){e.targets={},e.distractors={};var a,n=[];for(a in e.children){var i=e.children[a].name.split("-"),s=i.indexOf(t);s>-1?(name=i[(s+1)%i.length],e.targets[name]?e.targets[name].push(e.children[a]):e.targets[name]=[e.children[a]]):n.push(e.children[a])}for(var o in e.targets)e.distractors[o]=[];for(a in n){i=n[a].name.split("-");for(o in e.distractors)i.indexOf(o)>-1&&e.distractors[o].push(n[a])}},TASTER.Namespace("TASTER.Get"),TASTER.Get.IEntity=function(){return entity},TASTER.Namespace("TASTER.Get"),TASTER.Get.Obstacle=function(e,t,a,n){var i=new TASTER.Entity.Sprite(e,t,a,n);return e.physics.enable(i,Phaser.Physics.ARCADE),i.body.collideWorldBounds=!0,i.body.bounce.setTo(1),i.anchor.setTo(.5),i.addComponent(new TASTER.Component.Velocity(150)),i.addComponent(new TASTER.Component.GoalBehavior),i.addComponent(new TASTER.Component.ChaseBehavior),i.addComponent(new TASTER.Component.Hittable).onHit.add(function(){i.kill()}),i.animations.add("roll"),i.animations.play("roll",10,!0),i},TASTER.Namespace("TASTER.Get"),TASTER.Get.PanelTargets=function(e,t,a,n,i){var s={};return s.red=new Phaser.Sprite(e.game,0,0,t),s.red.anchor.setTo(.5,.5),s.blue=new Phaser.Sprite(e.game,0,0,a),s.blue.anchor.setTo(.5,.5),s.cube=new Phaser.Sprite(e.game,0,0,n),s.cube.anchor.setTo(.5,.5),s.pyramid=new Phaser.Sprite(e.game,0,0,i),s.pyramid.anchor.setTo(.5,.5),s},TASTER.Namespace("TASTER.Get"),TASTER.Get.PauseButton=function(e,t,a,n){var i=new TASTER.Entity.Sprite(e,t,a,n);return i.anchor.setTo(1,1),i.inputEnabled=!0,i.input.consumePointerEvent=!0,i.onPause=new Phaser.Signal,i.events.onInputDown.add(function(){i.game.input.activePointer.reset(),i.onPause.dispatch()}),i},TASTER.Namespace("TASTER.Get"),TASTER.Get.ObstacleWarning=function(e,t,a,n){return t=new TASTER.Entity.Sprite(e,t,a,n),e.physics.enable(t,Phaser.Physics.ARCADE),t.body.collideWorldBounds=!0,t.body.bounce.setTo(1),t.anchor.setTo(.5),t.addComponent(new TASTER.Component.FlashBehavior(100)),e=e.add.emitter(100,100),e.makeParticles("rock"),e.minParticleScale=.2,e.maxParticleScale=.5,t.addComponent(new TASTER.Component.Emitter(e)),t},TASTER.Namespace("TASTER.Get"),TASTER.Get.Player=function(e,t,a,n){var i=new TASTER.Entity.Sprite(e,t,a,n);return e.physics.enable(i,Phaser.Physics.ARCADE),i.body.collideWorldBounds=!0,i.body.immovable=!1,i.anchor.setTo(.5),i.addComponent(new TASTER.Component.Velocity(200)),i.addComponent(new TASTER.Component.GoalBehavior),i.addComponent(new TASTER.Component.FastBehavior(4)),i.addComponent(new TASTER.Component.FlashBehavior(50,!0)),i.addComponent(new TASTER.Component.GhostBehavior),i.addComponent(new TASTER.Component.GodBehavior),i.addComponent(new TASTER.Component.RecoilBehavior(500)),i.addComponent(new TASTER.Component.Emitter(TASTER.Get.BurstAndFadeEmitter(e,100,100,"red-circle"))),i.addComponent(new TASTER.Component.Hittable),i.getComponent("hittable").onHit.add(function(e,t){i.getComponent("goalBehavior").removeGoal(),i.getComponent("ghostBehavior").ghost(3e3),i.getComponent("recoilBehavior").recoil(t),i.getComponent("emitter").explode(1e3,10)}),i.addComponent(new TASTER.Component.Directional8),i.animations.add("e",Phaser.Animation.generateFrameNames(TASTER.Config.PLAYER_SPRITE_KEY+"_e-",1,4,"",2)),i.animations.add("n",Phaser.Animation.generateFrameNames(TASTER.Config.PLAYER_SPRITE_KEY+"_n-",1,4,"",2)),i.animations.add("ne",Phaser.Animation.generateFrameNames(TASTER.Config.PLAYER_SPRITE_KEY+"_ne-",1,4,"",2)),i.animations.add("nw",Phaser.Animation.generateFrameNames(TASTER.Config.PLAYER_SPRITE_KEY+"_nw-",1,4,"",2)),i.animations.add("s",Phaser.Animation.generateFrameNames(TASTER.Config.PLAYER_SPRITE_KEY+"_s-",1,4,"",2)),i.animations.add("se",Phaser.Animation.generateFrameNames(TASTER.Config.PLAYER_SPRITE_KEY+"_se-",1,4,"",2)),i.animations.add("sw",Phaser.Animation.generateFrameNames(TASTER.Config.PLAYER_SPRITE_KEY+"_sw-",1,4,"",2)),i.animations.add("w",Phaser.Animation.generateFrameNames(TASTER.Config.PLAYER_SPRITE_KEY+"_w-",1,4,"",2)),i},TASTER.Namespace("TASTER.Get"),TASTER.Get.ScorePanel=function(e,t,a,n){return t=new TASTER.Entity.Sprite(e,t,a,n),e.physics.enable(t,Phaser.Physics.ARCADE),t.body.collideWorldBounds=!0,t.body.immovable=!0,t.anchor.setTo(0,1),t},TASTER.Namespace("TASTER.Get"),TASTER.Get.SlowPowerUp=function(e,t,a,n,i){return t=new TASTER.Entity.Sprite(e,t,a,n),e.physics.enable(t,Phaser.Physics.ARCADE),t.body.collideWorldBounds=!0,t.body.immovable=!0,t.anchor.setTo(.5),t.addComponent(new TASTER.Component.Hittable).onHit.add(function(e){e.kill(),i.forEachAlive(function(e){(e=e.getComponent("slowBehavior"))&&e.slow(5e3)})}),t},TASTER.Namespace("TASTER.Get"),TASTER.Get.TargetPanel=function(e,t,a,n,i){return t=new TASTER.Entity.Sprite(e,t,a,n),e.physics.enable(t,Phaser.Physics.ARCADE),t.body.collideWorldBounds=!0,t.body.immovable=!0,t.anchor.setTo(.5,.5),t.targetSprites=i,t},TASTER.Namespace("TASTER.Get"),TASTER.Get.Sound=function(e){var t={};return t.game=e,t.sounds={},t.add=function(e){t.sounds[e]=t.game.add.audio(e)},t.play=function(e,a,n,i,s,o){t.sounds[e].play(a,n,i,s,o)},t.stop=function(e){t.sounds[e].stop()},t},TASTER.Namespace("TASTER.Get"),TASTER.Get.TextButton=function(e,t,a,n,i,s,o,r,l,c,d,T){return t=new Phaser.Button(e,t,a,n,s,o,r,l,c,d),t.text=new Phaser.BitmapText(e,12,12,"carrier-command",i,T),t.addChild(t.text),t},TASTER.Namespace("TASTER.Get"),TASTER.Get.EndPanel=function(e,t,a,n){var i=new TASTER.Entity.Sprite(e,t,a,n);return i.anchor.setTo(.5,.5),i.tween=i.game.add.tween(i).to({x:i.game.world.centerX,y:i.game.world.centerY},500,Phaser.Easing.Bounce.Out,!1),i.show=function(){i.reset(t,a),i.tween.start()},i.hide=function(){i.kill()},i},TASTER.Namespace("TASTER.Get"),TASTER.Get.TweenableTargetPanel=function(e,t,a,n,i){var s=new TASTER.Entity.Sprite(e,t,a,n);s.anchor.setTo(.5,.5);var o=s.game.add.tween(s).to({x:t+50,y:a},750,Phaser.Easing.Bounce.Out,!0);return e=s.game.add.tween(s).to({x:t,y:a},750,Phaser.Easing.Bounce.Out,!0),o.chain(e),s.targetSprites=i,s.inputEnabled=!0,s.input.consumePointerEvent=!0,s.events.onInputDown.add(function(){s.game.input.activePointer.reset(),o.start()}),s},TASTER.Namespace("TASTER.Get"),TASTER.Get.BurstAndFadeEmitter=function(e,t,a,n){return e=new Phaser.Particles.Arcade.Emitter(e,t,a),e.makeParticles(n),e.setXSpeed(100,-100),e.setYSpeed(100,-100),e.setRotation(50,-50),e.setAlpha(1,.01,1e3),e.setScale(.5,1,.5,1,1e3,Phaser.Easing.Quintic.Out),e},TASTER.Namespace("TASTER.Get"),TASTER.Get.CuePanel=function(e,t,a,n,i){var s=new TASTER.Entity.Sprite(e,t,a,n);return s.alpha=.5,s.anchor.setTo(.5,.5),s.tween=s.game.add.tween(s).to({x:s.game.world.centerX,y:s.game.world.centerY},500,Phaser.Easing.Bounce.Out,!1),e=s.game.add.tween(s).to({x:t,y:a},100,Phaser.Easing.Default,!1),e.delay(1e3),s.tween.chain(e),s.targetSprites=i,s.show=function(){s.reset(t,a),s.tween.start()},s.hide=function(){s.kill()},s},TASTER.Namespace("TASTER.Get"),TASTER.Get.EndPanel=function(e,t,a,n){var i=new TASTER.Entity.Sprite(e,t,a,n);return i.anchor.setTo(.5,.5),i.tween=i.game.add.tween(i).to({x:i.game.world.centerX,y:i.game.world.centerY},500,Phaser.Easing.Bounce.Out,!1),i.show=function(){i.reset(t,a),i.tween.start()},i.hide=function(){i.kill()},i},TASTER.Namespace("TASTER.Get"),TASTER.Get.Creature=function(e,t,a,n){var i=new TASTER.Entity.Sprite(e,t,a,n);e.physics.enable(i,Phaser.Physics.ARCADE),i.body.collideWorldBounds=!0,i.body.bounce.setTo(1),i.anchor.setTo(.5),i.addComponent(new TASTER.Component.Velocity(100)),i.addComponent(new TASTER.Component.FastBehavior(4)),i.addComponent(new TASTER.Component.GoalBehavior),i.addComponent(new TASTER.Component.ChaseBehavior).onGoalReached.add(function(){i.enableComponent("wanderBehavior")}),i.addComponent(new TASTER.Component.SlowBehavior(4)),i.addComponent(new TASTER.Component.WanderBehavior(e.rnd.integerInRange(3e3,5e3)));var s=i.addComponent(new TASTER.Component.Hittable);return s.onHit.add(function(e,t){var a=s.target.getComponent("collectable");a&&a.collect(e,t)}),i.addComponent(new TASTER.Component.Collectable).onCollect.add(function(){i.kill()}),i.addComponent(new TASTER.Component.Directional8),i.animations.add("e",Phaser.Animation.generateFrameNames(n+"_e-",1,2,"",2)),i.animations.add("n",Phaser.Animation.generateFrameNames(n+"_n-",1,2,"",2)),i.animations.add("ne",Phaser.Animation.generateFrameNames(n+"_ne-",1,2,"",2)),i.animations.add("nw",Phaser.Animation.generateFrameNames(n+"_nw-",1,2,"",2)),i.animations.add("s",Phaser.Animation.generateFrameNames(n+"_s-",1,2,"",2)),i.animations.add("se",Phaser.Animation.generateFrameNames(n+"_se-",1,2,"",2)),i.animations.add("sw",Phaser.Animation.generateFrameNames(n+"_sw-",1,2,"",2)),i.animations.add("w",Phaser.Animation.generateFrameNames(n+"_w-",1,2,"",2)),i.addComponent(new TASTER.Component.Decorator("white-ring")),i},TASTER.Namespace("TASTER.Get"),TASTER.Get.CreatureGroup=function(e,t,a){var n=new Phaser.Group(e);n.worldManager=a,n.onAllTargetsCollected=new Phaser.Signal,n.onChildCollected=new Phaser.Signal,n.keys=t,n.targets={},n.distractors={},n.distractorCount=0,n.create=function(t,a,i){return t=n.add(TASTER.Get.Creature(e,t,a,i)),(a=t.getComponent("collectable"))&&a.onCollect.add(n.collectChild,n,0,t),t},n.collectChild=function(e,t){n.onChildCollected.dispatch(e,t),n.countLiving()===n.distractorCount&&n.onAllTargetsCollected.dispatch()},n.disableAllComponents=function(e,t){for(var a in e)e[a].disableComponent(t)},n.enableAllComponents=function(e,t){for(var a in e)e[a].enableComponent(t)},n.setTask=function(e,t,a,i){n.distractorCount=t,n.callAll("kill"),TASTER.Task.Set.sort(n,a);var s=Math.floor(e*i);i=Math.floor(t*i),t-=i,TASTER.Task.Set.ensure(n,"targets",a,s,e-s,!0),TASTER.Task.Set.ensure(n,"distractors",a,i,t,!1);for(var o in n.distractors)n.disableAllComponents(n.distractors[o],"collectable");for(o in n.targets)n.enableAllComponents(n.targets[o],"collectable")};for(key in n.keys)n.create(0,0,n.keys[key]);return n},TASTER.Namespace("TASTER.Get"),TASTER.Get.FastPowerUp=function(e,t,a,n){return t=new TASTER.Entity.Sprite(e,t,a,n),e.physics.enable(t,Phaser.Physics.ARCADE),t.body.collideWorldBounds=!0,t.body.immovable=!0,t.anchor.setTo(.5),t.addComponent(new TASTER.Component.Hittable),t.getComponent("hittable").onHit.add(function(e,t){t.name===TASTER.Config.PLAYER_SPRITE_KEY&&(t.getComponent("fastBehavior").fast(5e3),e.kill())}),t},TASTER.Namespace("TASTER.Get"),TASTER.Get.Game=function(e,t){e.destroyables=[];var a=localStorage.getItem("activeProfile");a=TASTER.Util.getProfile(a);var n=[0,0,0],i=[0];a&&a.difficultySettingIndices&&(n=a.difficultySettingIndices),a&&a.switchingSettingIndices&&(i=a.switchingSettingIndices),e.dda=new TASTER.DDA.SimpleDDA([{name:"total",values:[4,6,8,10,12,14,16,18,20]},{name:"targets",values:[.9,.8,.7,.6,.5,.4,.3,.2,.1]},{name:"uniformity",values:[1,.75,.5]}],n),e.ddaTask=new TASTER.DDA.SimpleDDA([{name:"switch",values:[6,4,3,2,1]}],i),e.add.tileSprite(-TASTER.Config.WORLD_MARGIN,-TASTER.Config.WORLD_MARGIN,e.world.width+TASTER.Config.WORLD_MARGIN,e.world.height+TASTER.Config.WORLD_MARGIN,t),e.game.forceSignalUpdate=!0,e.physics.startSystem(Phaser.Physics.ARCADE),e.juice=e.game.plugins.add(new Phaser.Plugin.Juicy(e)),e.player=e.add.existing(TASTER.Get.Player(e.game,e.world.centerX,e.world.centerY,TASTER.Config.PLAYER_SPRITE_KEY)),e.destroyables.push(e.player),e.worldManager=new TASTER.World.Manager(TASTER.Util.getRectsFromRect(e.world,64,64),e.player),e.creatures=e.add.existing(TASTER.Get.CreatureGroup(e.game,TASTER.Config.CREATURE_KEYS,e.worldManager)),e.creatures.onAllTargetsCollected.add(function(){e.onTaskComplete()}),e.destroyables.push(e.creatures),e.fastPowerUp=e.add.existing(TASTER.Get.FastPowerUp(e.game,400,400,"lightning-bolt")).kill(),e.slowPowerUp=e.add.existing(TASTER.Get.SlowPowerUp(e.game,300,300,"clock",e.creatures)).kill(),e.destroyables.push(e.fastPowerUp),e.destroyables.push(e.slowPowerUp),e.warning=e.add.existing(TASTER.Get.ObstacleWarning(e.game,400,400,"warning")).kill(),e.obstacle=e.add.existing(TASTER.Get.Obstacle(e.game,400,400,"rock")).kill(),e.destroyables.push(e.warning),e.destroyables.push(e.obstacle),e.warning.events.onKilled.add(function(){var t=e.warning.getComponent("emitter");t&&(t.explode(1e3,10),e.juice.shake(),e.sound.play("explosion"))}),e.targetPanel="true"===localStorage.getItem("switching")?e.add.existing(TASTER.Get.TweenableTargetPanel(e.game,-20,42,"small-black-square",TASTER.Get.PanelTargets(e,"red-circle","blue-circle","wireframe-cube","wireframe-pyramid"))):e.add.existing(TASTER.Get.TargetPanel(e.game,10,42,"small-black-square-no-arrow",TASTER.Get.PanelTargets(e,"red-circle","blue-circle","wireframe-cube","wireframe-pyramid"))),e.scorePanel=e.add.existing(TASTER.Get.ScorePanel(e.game,10,e.game.height-10,"score-panel")),e.worldManager.addFixedObject(e.scorePanel),e.cuePanel=e.add.existing(TASTER.Get.CuePanel(e.game,e.world.centerX,-500,"large-black-square",TASTER.Get.PanelTargets(e,"red","blue","wireframe-cube-large","wireframe-pyramid-large"))),e.superPanel=e.add.existing(TASTER.Get.EndPanel(e.game,e.world.centerX,-500,"super-panel")),e.perfectPanel=e.add.existing(TASTER.Get.EndPanel(e.game,e.world.centerX,-500,"pefect-panel")),e.destroyables.push(e.targetPanel),e.destroyables.push(e.scorePanel),e.destroyables.push(e.cuePanel),e.destroyables.push(e.superPanel),e.destroyables.push(e.perfectPanel),e.pauseButton=e.add.existing(TASTER.Get.PauseButton(e.game,e.game.width-10,e.game.height-10,"pause-button")),e.worldManager.addFixedObject(e.pauseButton),e.pauseButton.onPause.add(e.pauseGame,e),e.destroyables.push(e.pauseButton),e.pausedText=e.add.image(e.world.centerX,100,"paused-text").kill(),e.pausedText.anchor.setTo(.5,.5),e.destroyables.push(e.pausedText),e.quitButton=e.add.image(e.world.centerX,200,"quit-button").kill(),e.quitButton.anchor.setTo(.5,.5),e.destroyables.push(e.quitButton),e.sound=TASTER.Get.Sound(e.game),e.sound.add("hurt"),e.sound.add("collect-coin"),e.sound.add("explosion"),e.sound.add("blip"),e.sound.add("alarm"),e.creatures.onChildCollected.add(function(){e.sound.play("collect-coin")}),e.player.getComponent("hittable").onHit.add(function(){e.sound.play("hurt"),e.juice.shake()}),e.score=e.add.bitmapText(e.scorePanel.x+8,e.scorePanel.y-50,"carrier-command","0",24),e.data=new TASTER.Data.Manager,e.data.onUpdate.add(function(){e.score.setText(e.data.game.score.toString())}),a=[e.player,e.fastPowerUp,e.slowPowerUp];for(var s in a)a[s].getComponent("hittable").onHit.add(function(t,a){e.data.save.event("hit",[t.name,a.name])});e.creatures.onChildCollected.add(function(t){e.data.save.event("collected",[t.name,e.task.target])}),e.data.updater.onFailStreak.add(function(){e.data.save.event("flailing")}),e.data.updater.onStreak.add(function(){e.data.save.event("streak")}),e.task=new TASTER.Task.Manager({color:["blue","red"],shape:["cube","pyramid"]},e.creatures,e.dda),e.task.onTaskSet.add(function(){e.showAllCues()}),"true"===localStorage.getItem("switching")&&(e.data.updater.onFailStreak.add(function(){e.addPowerUp()}),e.data.updater.onStreak.add(function(){e.addObstacleWarning()})),e.data.game.blockLength="true"===localStorage.getItem("switching")?e.ddaTask.getSetting().dimensions["switch"].value:12,e.data.onNewWave.add(function(){var t=e.dda.getSetting();e.data.game.wave.difficultySetting=t.dimensions.total.value+":"+t.dimensions.targets.value+":"+t.dimensions.uniformity.value}),e.showAllCues()},TASTER.Namespace("TASTER.Keyboard"),TASTER.Keyboard.OnScreen=function(e,t,a){this.gameState=e,this.graphics=this.gameState.add.graphics(0,0),this.maxLength=a,this.keyWidth=Math.min(t/10,64),this.startX=(t-10*this.keyWidth)/2,this.startY=this.gameState.height-4*this.keyWidth,this.createBackground(),this.text="",this.onTextUpdate=new Phaser.Signal,this.onEnter=new Phaser.Signal},TASTER.Keyboard.OnScreen.prototype.createBackground=function(){this.graphics.beginFill("red",1),this.graphics.drawRect(0,this.startY-this.keyWidth/2,this.gameState.world.width,6*this.keyWidth),this.graphics.endFill()},TASTER.Keyboard.OnScreen.prototype.createKeys=function(){var e,t=this.startY;for(e in this.rows){var a,n=this.rowStartX[e],i=this.rows[e];for(a in i){var s=i[a],o=this.keyWidth-16;("del"===s||"ret"===s)&&(o=Math.max(16,this.keyWidth/3)),this.addKey(s,n,t,o),n+=this.keyWidth}t+=this.keyWidth}},TASTER.Keyboard.OnScreen.prototype.addKey=function(e,t,a,n){switch(t=this.gameState.add.bitmapText(t,a,"carrier-command",e,n),t.inputEnabled=!0,t.hitArea=new Phaser.Rectangle(0,0,this.keyWidth,this.keyWidth),e){case"_":t.events.onInputDown.add(function(){this.text.length<this.maxLength&&(this.text+=" "),this.onTextUpdate.dispatch()},this);break;case"del":t.events.onInputDown.add(function(){this.text=this.text.slice(0,this.text.length-1),this.onTextUpdate.dispatch()},this);break;case"ret":t.events.onInputDown.add(function(){this.onEnter.dispatch()},this);break;default:t.events.onInputDown.add(function(){this.text.length<this.maxLength&&(this.text+=e),this.onTextUpdate.dispatch()},this)}},TASTER.Namespace("TASTER.Keyboard"),TASTER.Keyboard.Full=function(e,t,a){TASTER.Keyboard.OnScreen.call(this,e,t,a),this.rows=[["1","2","3","4","5","6","7","8","9","0"],["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l"],["z","x","c","v","b","n","m","del"]],this.rowStartX=[this.startX,this.startX,this.startX+this.keyWidth/2,this.startX+this.keyWidth/2],this.createKeys()},TASTER.Keyboard.Full.prototype=Object.create(TASTER.Keyboard.OnScreen.prototype),TASTER.Keyboard.Full.prototype.constructor=TASTER.Keyboard.Full,TASTER.Namespace("TASTER.Keyboard"),TASTER.Keyboard.Numeric=function(e,t,a){TASTER.Keyboard.OnScreen.call(this,e,t,a),this.rows=[["1","2","3"],["4","5","6"],["7","8","9"],["del"]],this.rowStartX=[this.startX+3.5*this.keyWidth,this.startX+3.5*this.keyWidth,this.startX+3.5*this.keyWidth,this.startX+3.5*this.keyWidth],this.createKeys()},TASTER.Keyboard.Numeric.prototype=Object.create(TASTER.Keyboard.OnScreen.prototype),TASTER.Keyboard.Numeric.prototype.constructor=TASTER.Keyboard.Numeric,TASTER.Namespace("TASTER.Util"),TASTER.Util.rnd=new Phaser.RandomDataGenerator,TASTER.Util.getRectsFromRect=function(e,t,a){for(var n=[],i=e.width-t,s=e.height-a,o=e.x;i>o;o+=t)for(var r=e.y;s>r;r+=a){var l=new Phaser.Rectangle(o,r,t,a);n.push(l)}return n},TASTER.Util.setMusicSetting=function(e){switch(e){case!0:localStorage.setItem("music","true");break;case!1:localStorage.setItem("music","false")}},TASTER.Util.getMusicSetting=function(){switch(localStorage.getItem("music")){case"true":return 1;case"false":return 0;default:return 1}},TASTER.Util.getProfile=function(e,t){var a,n=TASTER.Util.getProfiles();for(a in n)if(n[a].name===e)return t?a:n[a]},TASTER.Util.getProfiles=function(){return JSON.parse(localStorage.getItem("tasterProfiles"))||[]},TASTER.Util.saveProfile=function(e){var t=TASTER.Util.getProfiles(),a=TASTER.Util.getProfile(e.name,!0);t[a]=e,TASTER.Util.saveProfiles(t)},TASTER.Util.saveProfiles=function(e){localStorage.setItem("tasterProfiles",JSON.stringify(e))},TASTER.Util.isPerfectGame=function(e){var t,a=!0;for(t in e)e[t].successRate<1&&(a=!1);return a},TASTER.Util.assessSwitchingSkill=function(e,t){var a,n=[],i=[];for(a in e)t>a?n.push(e[a]):(t===a||2*t>a)&&i.push(e[a]);var s=0,o=0;for(a in n)s+=n[a].timePerTarget;for(a in i)o+=i[a].timePerTarget;switch(s/t>=o/t){case!0:return"harder";default:return"easier"}},TASTER.Util.pauseGame=function(e,t){for(var a=(new Date).getTime(),n=(new Date).getTime();t>n-a;)n=(new Date).getTime(),e.paused=!0;e.paused=!1},TASTER.Util.moveArrayElement=function(e,t,a){e.splice(a,0,e.splice(t,1)[0])},TASTER.Util.removeArrayElement=function(e,t){for(var a;-1!=(a=e.indexOf(t));)e.splice(a,1)},TASTER.Util.elementInString=function(e,t){var a=[];return e.forEach(function(e){-1!==t.indexOf(e)&&a.push(e)}),a},TASTER.Util.getPointInPath=function(e,t,a){t||(t=50),a||(a=10);var n=e.position;return t=Phaser.Point.add(n,t),!e.game.world.bounds.contains(t.x,t.y)||Phaser.Point.distance(n,t)<a?new Phaser.Point(e.game.world.randomX,e.game.world.randomY):t},TASTER.Util.getRndVectorInRange=function(e,t,a){var n=TASTER.Util.rnd.between(e,t);return e=TASTER.Util.rnd.between(e,t),a&&(n*=Math.random()<.5?-1:1,e*=Math.random()<.5?-1:1),new Phaser.Point(n,e)},TASTER.Util.reverseDirection=function(e){e.body.velocity.invert()},TASTER.Util.getDirection=function(e){return 0===e.body.velocity.x&&0===e.body.velocity.y?e.animations.currentFrame.name:TASTER.Util.DIRECTIONS[Math.round(8*Math.atan2(e.body.velocity.x,e.body.velocity.y)/(2*Math.PI)+8)%8]},TASTER.Util.DIRECTIONS={0:"s",1:"se",2:"e",3:"ne",4:"n",5:"nw",6:"w",7:"sw"},TASTER.Namespace("TASTER.World"),TASTER.World.Manager=function(e,t){this.rectangles=e,this.target=t,this.occupied=[]},TASTER.World.Manager.prototype.getRects=function(e,t,a){for(var n=[],i=0;i<this.rectangles.length;i++){var s=new Phaser.Point(this.rectangles[i].centerX,this.rectangles[i].centerY);t&&Phaser.Point.distance(s,e,!0)>t&&n.push(this.rectangles[i]),a&&Phaser.Point.distance(s,e,!0)<a&&n.push(this.rectangles[i])}return n},TASTER.World.Manager.prototype.getRandomPoint=function(e,t,a){return a=a||this.target,e=this.getRects(a,e,t),t=Phaser.ArrayUtils.getRandomItem(e),0===e.length?!1:new Phaser.Point(t.centerX,t.centerY)},TASTER.World.Manager.prototype.releaseRectangle=function(e){e=this.getRectangleByOccupant(e),void 0!==e&&(this.rectangles.push(e.rectangle),TASTER.Util.removeArrayElement(this.occupied,e))},TASTER.World.Manager.prototype.occupyRectangle=function(e,t){this.occupied.push({rectangle:e,occupant:t}),TASTER.Util.removeArrayElement(this.rectangles,e)},TASTER.World.Manager.prototype.addFixedObject=function(e){for(var t=new Phaser.Rectangle(e.left,e.top,e.width,e.height),a=this.rectangles.length-1;a>=0;a--)Phaser.Rectangle.intersects(t,this.rectangles[a])&&this.occupyRectangle(this.rectangles[a],e)},TASTER.World.Manager.prototype.getRectangleByOccupant=function(e){for(var t=0;t<this.occupied.length;t++)if(this.occupied[t].occupant===e)return this.occupied[t]};
